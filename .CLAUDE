# Financial Tracker - Godot Mobile Game

## Project Overview

Converting existing financial tracker web app into a Godot mobile game with custom pixel art UI.

### Key Decisions

- Platform: Godot (instead of WeChat Mini Program)
- Storage: Local save data only (using Godot's FileAccess system, no backend)
- UI Style: Custom pixelated assets for game-like feel (not using built-in Godot UI components)
- Complexity: Simpler than previous basketball game - mainly UI screens and data management

### Core Features

- Goal tracking & progress visualization
- Investment/transaction logging (CDs, T-bills, etc.)
- Save/load system
- Four main screens: Dashboard, Tracker, History, Instruction

### UI Design

- Color scheme: Dark blue/teal with pixel art style
- Bottom navigation: 4 circular buttons for main screens
- Card-based layout for investments/goals
- See: Assets/mockup.png for full design reference

---

## Progress Log

### 2025-12-25 (Previous Session - Reconstructed)

**Completed:**

- âœ“ Project setup (commit: 69ed230)
- âœ“ Navigator scene with 4 bottom navigation buttons
- âœ“ Created four main placeholder scenes: Dashboard, Tracker, History, Instruction (commit: b920a36)
- âœ“ Added mockup.png design reference to Assets/

**Current State:**

- Navigator functional with scene switching
- Each main scene is a placeholder, needs implementation

**Next Steps:**

- Implement Dashboard scene (stats: TPV/TPC/TIE => Totoal Portfolio Value, Total Principal Contributed, Total Interest Earned, progress bar, upcoming maturity table)
- Create reusable card component for Tracker/History
- Design data structures for investments/goals
- Implement save/load system

---

### 2025-12-26

**Completed:**

- âœ“ Created .CLAUDE file for progress tracking
- âœ“ Implemented ProgressBar scene using TextureProgressBar (Scenes/ProgressBar/TextureProgressBar.tscn)
  - Used AtlasTexture to extract progress bar sprites from FT_sprites_6x.png
  - Configured texture_under (light orange background) and texture_progress (dark orange fill)
  - Set up nine-patch stretching for scalability
- âœ“ Created ProgressCard scene (Scenes/ProgressCard/ProgressCard.tscn)
  - Used NinePatchRect container with card background
  - Integrated TextureProgressBar instance
  - Added title label, percentage label, and cancel button
  - Created ProgressCard.gd script with basic label setup
- âœ“ Researched table implementation options for maturity table card
  - Decided on GridContainer approach (most conventional for game UI tables)

**Current State:**

- Dashboard components: DashboardValueCard âœ“, ProgressCard âœ“
- Still need: Maturity Table Card (will use GridContainer)

**Next Steps:**

- Create MaturityTableCard scene with GridContainer (3 columns: Date, Type, Value)
- Assemble all components into Dashboard scene
- Add logic for data binding and updates
- Design data structures for investments/goals

---

### 2025-12-27

**Completed:**

- âœ“ Created UpcomingMaturity scene (Scenes/UpcomingMaturityCard/UpcomingMaturity.tscn)
  - Used NinePatchRect container with Card.png background
  - Implemented GridContainer with 3 columns: Maturity Date, Type, Matured Value
  - Added header row and one dummy data row
  - Set up spacing: h_separation=50, v_separation=10
  - Used LabelTexture_12(03)_blue label settings for consistent styling
- âœ“ Reviewed React financial tracker app architecture (/Users/xiyuchen/Documents/Xiyu/Workspace/web_application/financial-tracker-app)
  - Confirmed data flow: Tracker page (CRUD operations) â†’ Dashboard (display aggregated data)
  - Dashboard shows: PanelSection (TPV/TPC/TIE), ProgressBar, MaturityDetails
  - Tracker shows: Full investment table with CreateInvestment and InvestmentDelete components
- âœ“ Created InvestmentCard scene (Scenes/InvestmentCard/InvestmentCard.tscn)
  - NinePatchRect root with Card.png background
  - GeneralInfoGrid (2 columns): Start Date, End Date, Type, Rate
  - AmountInfoGrid (2 columns): Amount, Actual Cost, Earned, Final Value
  - TextureButton in top-right corner (for delete functionality)
  - InvestmentCard.gd script with isActive logic
  - Preloads CARD_ACTIVE and CARD_INACTIVE textures
  - Simple @export var isActive: bool for testing (will be replaced with date comparison logic later)

**Key Discussions:**

- UI approach difference between Dashboard and Tracker:
  - **Dashboard upcoming maturity**: Simple GridContainer table (just built)
  - **Tracker page**: Card-based layout - each investment gets its own card
  - Reason: More game-like, visual, and mobile-friendly than traditional tables
- Data flow confirmed: Tracker page is the source of truth for investment data
  - Dashboard reads and displays computed/aggregated views
  - Makes sense to build Tracker page functionality first
- Scrollable container: Use **ScrollContainer** with VBoxContainer/VBoxContainer child
  - ScrollContainer handles overflow and scrollbars automatically
  - VBoxContainer stacks InvestmentCard instances vertically

**Next Steps:**

- Create Tracker scene with ScrollContainer to hold multiple InvestmentCard instances
  - Structure: Tracker â†’ ScrollContainer â†’ VBoxContainer â†’ InvestmentCards
  - Configure scroll settings (vertical only, auto scrollbars)
- Implement logic to dynamically add/populate InvestmentCard instances
- Define data structures for investments (Dictionary or custom class)
- Add create new investment functionality
- Add delete investment functionality (wire up TextureButton)
- Implement save/load system using Godot's FileAccess
- Update InvestmentCard to calculate isActive from maturity date vs current date
- Wire up Dashboard to display data from saved investments

---

### 2025-12-28

**Completed:**

- âœ“ Fixed Tracker scene layout issue - moved TextureRect (background) above ScrollContainer so cards are visible
- âœ“ Set up InvestmentCard with custom_minimum_size in VBoxContainer for proper sizing
- âœ“ Decided on data structure approach: **Custom Class (Investment extends Resource)** over Dictionary
  - Rationale: Type safety, autocomplete, computed properties, easier maintenance
- âœ“ Created Scripts/ folder for project organization
- âœ“ Implemented Investment.gd resource class (Scripts/Investment.gd)
  - @export properties: start_date, type, rate, amount, actual_cost
  - Removed end_date from properties (now computed via get_end_date() method)
  - Computed methods:
    - `get_interest_earned()` - Calculates interest: CD uses rate formula, T-Bill uses discount (amount - actual_cost)
    - `get_matured_value()` - Returns final value: CD = amount + interest, T-Bill = amount (face value)
    - `get_status()` - Checks if investment is active by comparing current date with end_date
    - `get_end_date()` - Calculates maturity date (start_date + 3 months)
  - Used Godot's Time API: get_datetime_dict_from_datetime_string(), get_datetime_string_from_datetime_dict()
- âœ“ Reviewed React financial tracker form structure to understand:
  - User inputs: start_date, type (CD/T-Bill), amount/face_value, rate/actual_cost
  - CD fields: Amount ($) and Rate (%)
  - T-Bill fields: Face Value ($) and Actual Cost ($)
  - End date auto-calculated as start_date + 3 months
  - All investments default to 3-month term

**Key Learnings:**

- String comparison works for "YYYY-MM-DD" date format in GDScript
- Time.get_datetime_string_from_datetime_dict() can be split with `.split("T")[0]` to extract date portion
- For T-Bills, matured_value equals face value (amount), not amount + interest

**Current State:**

- Investment class is 95% complete
- Tracker scene has ScrollContainer â†’ VBoxContainer â†’ InvestmentCard structure set up
- Still need: serialization methods (to_dict, from_dict) for save/load functionality

**Todo List Status:**

âœ… Completed (3):
1. Create Investment.gd class with @export properties
2. Add computed methods to Investment class
3. Add helper methods to Investment class (get_end_date)

ðŸ”„ In Progress (1):
4. Add serialization methods to Investment class: to_dict() and from_dict() for save/load

ðŸ“‹ Pending (10):
5. Create investments list in Tracker.gd script to hold array of Investment objects
6. Add 'Add Investment' button to Tracker scene UI
7. Create investment form popup/dialog scene with input fields
8. Implement form logic to handle CD vs T-Bill (conditional field labels)
9. Wire up form submit to create Investment object and add to investments array
10. Implement dynamic InvestmentCard spawning in VBoxContainer based on investments array
11. Update InvestmentCard.gd to accept Investment object and populate labels with real data
12. Wire up delete button on InvestmentCard to remove investment from array and refresh UI
13. Implement save system: save investments array to JSON file using FileAccess
14. Implement load system: load investments from JSON file on game start

**Next Steps:**

- Complete serialization methods (to_dict and from_dict) in Investment.gd
- Create Tracker.gd script and add investments array
- Add "Add Investment" button to Tracker scene
- Build investment form popup/dialog with conditional CD/T-Bill fields
- Implement form submission and dynamic card spawning

---

### 2025-12-31

**Completed:**

- âœ“ Implemented serialization methods in Investment.gd (Scripts/Investment.gd:12-28)
  - `to_dict()` - Converts Investment object to Dictionary for JSON serialization
  - `from_dict(dict: Dictionary)` - Static method to create Investment from Dictionary
  - Uses safe dictionary access with `.get(key, default)` for fallback values
- âœ“ Created DataManager.gd autoload singleton (Autoloads/DataManager.gd)
  - `save_investments(investments: Array[Investment])` - Writes investments array to user://investments.json
  - `load_investments()` - Reads and deserializes investments from JSON file
  - Proper error handling for file operations and JSON parsing
  - Uses `FileAccess` API and `JSON.stringify()` / `JSON.parse()`
- âœ“ Implemented Tracker.gd script (Scenes/Tracker/Tracker.gd)
  - Loads saved investments on `_ready()` using DataManager
  - Dynamically instantiates InvestmentCard for each investment
  - Populates card data: start_date, end_date, type, rate, amount, actual_cost, interest_earned, matured_value
  - Sets `is_active` based on `investment.get_status()`
- âœ“ Updated InvestmentCard.gd to accept and display investment data (Scenes/InvestmentCard/InvestmentCard.gd)
  - Added class_name InvestmentCard for type safety
  - Added properties: start_date, end_date, type, rate, amount, actual_value, interest_earned, matured_value, is_active
  - Created `setup()` method to populate all label fields
  - Implemented proper type conversion: `str(rate) + '%'`, `'$' + str(amount)`, etc.
  - Active/inactive card texture switching based on `is_active` boolean

**Key Discussions:**

- **Save/load architecture**:
  - DataManager as autoload singleton (not static utility class) for global access
  - Investment serialization only includes @export properties (computed values calculated on-demand)
  - Save file location: `user://investments.json` (platform-specific user data directory)
- **Card instantiation pattern**:
  - Important: Must instantiate new card **inside** the loop (not reuse same instance)
  - Each card gets populated with data before being added to VBoxContainer
- **Data flow in Tracker**:
  - Load from file â†’ create Investment objects â†’ instantiate cards â†’ populate data â†’ add to scene tree

**Current State:**

- âœ… Complete save/load system working
- âœ… Tracker page displays saved investments as cards
- âœ… Cards show correct data with proper formatting
- âœ… Active/inactive styling based on maturity status
- ðŸŽ¨ **Next**: Need to design "Add Investment" button pixel art in Aseprite

**Todo List Status:**

âœ… Completed (7):
1. Add serialization methods to Investment class (to_dict, from_dict)
2. Create DataManager.gd autoload with save/load methods
3. Create Tracker.gd script with investments array and load logic
4. Implement dynamic InvestmentCard spawning in VBoxContainer
5. Update InvestmentCard.gd to accept Investment object and populate labels
6. Implement save system using FileAccess
7. Implement load system on game start

âœ… Completed (1):
8. Design "Add Investment" button pixel art in Aseprite

ðŸ“‹ Pending (4):
9. Add "Add Investment" button to Tracker scene UI
10. Create investment form popup/dialog scene with input fields (start_date, type selector, conditional CD/T-Bill fields)
11. Implement form logic:
   - Type selector switches between CD and T-Bill input fields
   - CD: Amount ($), Rate (%)
   - T-Bill: Face Value ($), Actual Cost ($)
   - Form submission creates Investment object, adds to array, saves to file, refreshes UI
12. Wire up delete button on InvestmentCard to remove investment from array and refresh UI

**Next Steps:**

- Add button to Tracker scene (position above or below ScrollContainer)
- Create investment form popup/dialog scene
- Implement form validation and submission logic
- Add delete functionality to InvestmentCard

---

### 2026-02-12

**Completed:**

- âœ“ Fixed fullscreen issue - project was launching in fullscreen mode (window/size/mode=3 in project.godot), identified the setting
- âœ“ Redesigned navigation button sprites in Aseprite (FT_sprites_6x.png)
  - Normal state: Added shadow around the button to make center sphere stand out
  - Hover animation: 7 frames - highlight on the rounded button rotates in circles, indicating selection
  - Pressed state: Center sphere shifted down to give a "pressed" feel
- âœ“ Imported new button sprites into Navigator scene using AtlasTexture regions
- âœ“ Discovered and fixed AnimatedTexture + AtlasTexture bug
  - **Problem**: Godot's AnimatedTexture ignores AtlasTexture region coordinates, renders from top-left of full spritesheet instead
  - **Solution chosen**: Script-based hover animation (over splitting spritesheet into individual PNGs, which would be too tedious)
  - Implemented in Navigator.gd: Timer-based frame cycling that swaps `texture_hover` to individual AtlasTexture objects on each tick
  - `_setup_hover()` creates AtlasTexture frames from spritesheet regions, wires up mouse_entered/mouse_exited signals and Timer
  - Applied hover animation to all 4 buttons: Dashboard, Tracker, History, Instruction
- âœ“ Wrote weekly video transcript (Chinese) covering this session's work

**Key Learnings:**

- AnimatedTexture does NOT work with AtlasTexture frames in Godot - known limitation
- Workaround: Swap `texture_hover` property directly with individual AtlasTexture objects via Timer, bypassing AnimatedTexture entirely
- project.godot `window/size/mode` values: 0=Windowed, 1=Minimized, 2=Maximized, 3=Fullscreen, 4=Exclusive Fullscreen

**Current State:**

- Navigation buttons fully redesigned with normal/hover/pressed states working
- All 4 buttons have animated hover effect via script
- Project back on track after vacation break

**Note:** When wrapping up for the day, automatically log progress to .CLAUDE

**Next Steps:**

- Continue with functional development (pending tasks from 2025-12-31)
- Add "Add Investment" button to Tracker scene UI
- Create investment form popup/dialog scene
- Implement form logic and delete functionality

---

### 2026-02-17

**Completed:**

- âœ“ Built Instruction page (Scenes/Instruction/Instruction.tscn)
  - VBoxContainer with Title (Label) and Instruction (RichTextLabel)
  - Used BBCode with hex color codes for styled text (e.g., `[color=#hex]...[/color]`)
  - Fixed mouse input blocking: set `mouse_filter = 2` (Ignore) on VBoxContainer so Navigator buttons remain clickable
- âœ“ Created AddButton scene (Scenes/AddButton/AddButton.tscn)
  - Reusable "+" button for both investment and goal creation
  - TextureButton with normal texture from FT_sprites_6x.png at Rect2(312, 6, 54, 54)
  - Implemented hover animation in AddButton.gd using same Timer-based approach as Navigator.gd
  - 8 hover frames from spritesheet (3Ã—3 grid minus 1, top-right corner)
- âœ“ Added AddButton to Tracker scene header
  - HBoxContainer with Title (Fill+Expand) and AddButton (right-aligned)
  - Wrapped AddButton in plain Control node to allow scale (0.8) inside container

**Key Learnings:**

- RichTextLabel with `bbcode_enabled` supports inline color styling via `[color=#hex]...[/color]`
- Control nodes with large rects can block mouse input to nodes behind them â€” fix with `mouse_filter = 2` (Ignore)
- Containers (HBoxContainer, VBoxContainer) override children's scale/size â€” wrap in a plain Control node to preserve scale
- `size_flags_horizontal = 3` (Fill + Expand) on a label inside HBoxContainer = flexbox space-between equivalent

**Current State:**

- Instruction page complete with styled text
- AddButton scene reusable with hover animation
- Tracker header has title + add button layout

**Next Steps:**

- Create investment form popup/dialog scene with input fields (start_date, type selector, conditional CD/T-Bill fields)
- Implement form logic: type selector, validation, submission
- Wire up AddButton press to open the form
- Wire up delete button on InvestmentCard
- Replicate AddButton usage for goal creation on Dashboard

---

### 2026-02-18

**Completed:**

- âœ“ Created Popup scene (Scenes/Popup/Popup.tscn)
  - Custom overlay approach (#2) chosen over Godot's built-in Popup nodes â€” more flexible for pixel art style
  - Control root (full-screen) â†’ ColorRect (dim background, ~40% black) â†’ NinePatchRect (Modal, centered, Card.png)
  - MarginContainer inside Modal for content layout
- âœ“ Created RadioButton scene (Scenes/RadioButton/RadioButton.tscn)
  - Reusable component: Control root â†’ HBoxContainer â†’ CDButton + TbillButton
  - Both TextureButtons with `toggle_mode = true` and shared ButtonGroup resource (Resources/ButtonGroup/new_button_group.tres)
  - CDButton defaults to `button_pressed = true`
  - Normal/pressed textures from FT_sprites_6x.png spritesheet
- âœ“ Created Checkbox scene (Scenes/Checkbox/Checkbox.tscn)
  - Standalone TextureButton with `toggle_mode = true`
  - Normal (unchecked) and pressed (checked) textures from spritesheet
  - For the "reinvesting from matured investments" toggle
- âœ“ Added RadioButton and Checkbox to Popup scene inside Modal with MarginContainers
- âœ“ Fixed Navigator hover coordinates for TrackerButton, HistoryButton, InstructionButton
  - Updated y values from old (318, 570, 696, 822, 948, 1074, 1200) to corrected (414, 666, 792, 918, 1044, 1170, 1296)

**Key Learnings:**

- Godot popup approaches: built-in Popup nodes (themed), custom overlay (flexible), CanvasLayer (layering), Window (desktop only)
- TextureButton `toggle_mode` + `ButtonGroup` = radio button behavior with no code needed
- Don't use "disabled" state for unselected radio buttons â€” disabled blocks input. Use normal = unselected, pressed = selected
- `button_pressed = true` in Inspector to default a toggle button to active state

**Current State:**

- Popup form has: radio buttons (CD/T-Bill selector), checkbox (reinvest toggle)
- Still need: input fields, date picker, submit/cancel buttons, form logic

**Next Steps:**

- Implement input fields using hybrid approach (transparent LineEdit on top of pixel art NinePatchRect)
- Implement date picker (most complex component â€” no built-in Godot date picker)
- Add submit/cancel buttons to form
- Implement form logic: type selector switches fields, validation, submission
- Wire up AddButton press to open Popup
- Wire up delete button on InvestmentCard

---

### 2026-02-21

**Completed:**

- âœ“ Created InputField scene (Scenes/InputField/InputField.tscn)
  - Hybrid approach: NinePatchRect (pixel art background) + transparent LineEdit on top
  - LineEdit: StyleBoxEmpty on normal + focus, virtual_keyboard_type = NUMBER_DECIMAL, max_length = 10
- âœ“ Built out Popup form with all UI components:
  - Two input groups (FirstInputMarginContainer, SecondInputMarginContainer)
  - Each has a plain Control wrapper with two overlapping labels (one visible, one hidden)
  - AmountLabel/FaceValueLabel swap for first field; RateLabel/ActualCostLabel swap for second
  - Both reuse the same InputField instances â€” labels toggle, fields stay
  - ReinvestedMarginContainer (hidden by default) with Label + InputField â€” no Control wrapper needed since only one label
  - Checkbox toggled signal connected to Popup.gd (_on_checkbox_toggled)
  - All 5 labels have unique inline LabelSettings sub-resources
- âœ“ Attached Popup.gd script to Popup root node

**Key Learnings:**

- Plain Control wrapper around overlapping labels causes VBoxContainer to need separation = 18 to compensate for wrapper height; direct Label â†’ InputField layout uses default separation naturally
- Checkbox state: use `button_pressed` property to read; connect `toggled` signal for reactive updates
- Modal height can be adjusted in script via `offset_top` and `offset_bottom` symmetrically (center anchor)

**Current State:**

- Popup form UI complete: RadioButton, two input fields with swappable labels, Checkbox + label, Reinvested Amount field (hidden)
- Script stub exists but no logic yet

**Next Steps (in order):**

1. Submit/Cancel buttons â€” draw pixel art, add to Popup scene
2. Date picker â€” design and draw pixel art UI in Aseprite
3. Input logic â€” RadioButton toggle swaps labels + clears fields; Checkbox toggle shows/hides reinvest field + resizes modal; form submission creates Investment object
4. Date picker logic â€” implement custom date picker interaction

---

### 2026-02-23

**Completed:**

- âœ“ Drew and added the Submit button to the Popup form â€” pixel art has normal and pressed states
- âœ“ Drew and added the Cancel button to the Popup form
- âœ“ Implemented RadioButton.gd
  - `signal type_changed(type: String)` emitted when either button is toggled on
  - `_on_cd_button_toggled` and `_on_tbill_button_toggled` both guard with `if toggled_on` to avoid double-firing from ButtonGroup's auto-deselect behavior
- âœ“ Implemented Popup.gd logic
  - Connected `radio_button.type_changed` in `_ready()` to `_on_type_changed()`
  - `_on_type_changed()` calls `show_hide_cd_labels()` and `show_hide_tbill_labels()` accordingly
  - `_on_checkbox_toggled()` shows/hides `reinvested_margin_container` and resizes modal symmetrically via `offset_top`/`offset_bottom`
  - `_on_cancel_button_pressed()` calls `hide()` directly (script is on the root node itself)

**Hiccups Encountered (good video content):**

1. **`self.hide()` vs redundant node reference**: Initially wrote `@onready var popup: Control = $"."` to get a reference to the root node, then called `popup.hide()`. Realized a script attached to a node can just call `hide()` directly â€” no need to reference itself.

2. **Unnecessary `else` fallback (TypeScript habit)**: Added a default `else` branch in `_on_type_changed()` out of habit from TypeScript/ESLint, where linters often enforce exhaustive conditionals. In GDScript there's no such enforcement â€” the else was unreachable dead code since only `'cd'` and `'tbill'` are ever emitted. Good reminder that GDScript is more relaxed about this than TypeScript.

3. **AtlasTexture region height for pressed button state**: When drawing the Submit button, the pressed sprite is shorter than the normal one. Initially selected only the exact pixel bounds of the shorter sprite for the pressed AtlasTexture region â€” this made the button look like it was shrinking upward rather than being pushed down. Fix: select a region of the **same height** as the normal state, but leave transparent empty space at the **top**, so the button pixels sit at the bottom of the bounding box, correctly simulating a pushed-down effect.

**Current State:**

- Popup form UI and logic complete: RadioButton (type switching), Checkbox (reinvest toggle + modal resize), Cancel button, Submit button (logic stubbed)
- DatePicker UI complete (Year, Month, Day pickers with up/down buttons and NinePatchRect label)
- DatePicker logic complete (up/down increment/decrement, value_changed signal, update_label on init)
- Still needs: Popup.gd connecting DatePicker signals + day clamping, form submission logic

**Next Steps:**

- Popup.gd â€” connect all three DatePicker `value_changed` signals, assemble date dict, handle day clamping via `set_value()` on day picker
- Form submission â€” wire up Submit button to create Investment object, save, refresh Tracker UI
- Wire up AddButton press to open Popup
- Wire up delete button on InvestmentCard

---

## Add Investment Form â€” Field Specification

### Date Picker
- Picks the **starting date** of the investment

### Investment Type (CD or T-Bill â€” toggled by RadioButton)

**CD fields:**
- Amount â†’ amount invested ($)
- Rate â†’ interest rate (%)

**T-Bill fields:**
- Face Value â†’ amount when T-Bill matures ($)
- Actual Cost â†’ actual purchase cost of the T-Bill ($)

### Reinvesting Checkbox (bottom of form)
- Checkbox: "Reinvesting from matured investment?"
- If checked, shows one additional field:
  - Reinvested Amount â†’ amount taken from a previously matured investment ($)
  - This represents the portion of the new investment funded by a prior maturity

### Input Field Implementation
- Hybrid approach: transparent `LineEdit` layered on top of pixel art `NinePatchRect` background
- Number fields: `virtual_keyboard_type = NUMBER_DECIMAL`
- CD and T-Bill field groups are shown/hidden based on RadioButton selection
